---
import EventCalendar from '@/components/EventCalendar';
import AppLayout from '@/layouts/AppLayout.astro';
import type { CalendarItemDto } from '@/lib/api';
import { api } from '@/lib/apiClient';

const sessionToken = Astro.cookies.get('bb_session')?.value;
if (!sessionToken) {
  return Astro.redirect('/login');
}

let events: CalendarItemDto[] = [];

try {
  const { data } = await api.api.calendarList(
    { currentDate: new Date().toISOString() },
    { headers: { 'X-Session-Cookie': sessionToken } },
  );

  if (data) {
    events = data;
  }
} catch (error) {
  console.error('Error validating session:', error);
}
---

<AppLayout>
  <div class="flex-1 w-full border rounded-lg shadow-sm bg-card overflow-auto">
    <EventCalendar client:load events={events} />
  </div>
</AppLayout>
