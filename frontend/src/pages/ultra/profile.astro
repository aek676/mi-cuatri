---
import Logout from '@/components/Logout.astro';
import ProfileComponent from '@/components/Profile.astro';
import AppLayout from '@/layouts/AppLayout.astro';
import { actions } from 'astro:actions';

const logoutResult = Astro.getActionResult(actions.logout);
if (logoutResult && !logoutResult.error) {
  return Astro.redirect('/login');
}

const sessionToken = Astro.locals.sessionToken;
const user = Astro.locals.user;

if (!sessionToken || !user) {
  return Astro.redirect('/login');
}
---

<AppLayout>
  <ProfileComponent user={user} sessionToken={sessionToken}>
    <Logout />
  </ProfileComponent>
</AppLayout>
